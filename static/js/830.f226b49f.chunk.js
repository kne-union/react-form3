"use strict";(self.webpackChunk_kne_components_react_form=self.webpackChunk_kne_components_react_form||[]).push([[830],{71830:(e,t,r)=>{r.r(t),r.d(t,{GroupList:()=>Se,RULES:()=>he,compileErrMsg:()=>j,computedFieldValueFromFormData:()=>Pe,computedFormDataFormState:()=>Ce,default:()=>Fe,filterEmpty:()=>L,findField:()=>Re,formUtils:()=>Oe,interceptors:()=>ue,isEmpty:()=>O,isNotEmpty:()=>P,matchFields:()=>De,preset:()=>ve,stateToError:()=>$e,stateToIsPass:()=>Ne,useField:()=>xe,useFormApi:()=>B,useFormContext:()=>B,useGroup:()=>Ee,useReset:()=>Me,useSubmit:()=>we});var a=r(14888),n=r.n(a),s=r(27497),i=r.n(s),o=r(18710),u=r.n(o),l=r(92679),m=r.n(l),d=r(33227),c=r.n(d),f=r(33076),g=r.n(f),p=r(71406),h=r.n(p),v=r(9211),F=r.n(v),b=r(73075),y=r.n(b),E=r(25647),I=r.n(E),S=r(94922),V=r.n(S),A=r(78430),x=(r(98171),r(78678)),M=r(20775),w=r.n(M),N=r(60094),$=r.n(N),C=r(57325),R=r.n(C),D=r(98424);const P=e=>{if(n()(e)){const t=i()(e);return t.length>0&&t.some(e=>!!e)}return u()(e)?e.length>0:"number"===typeof e?!isNaN(e):!(void 0===e||null===e||""===e||0===e.length)},O=e=>!P(e),L=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(u()(e))return e.map(e=>L(e)).filter(P);if(n()(e)){const t={};return Object.keys(e).forEach(r=>{const a=L(e[r]);P(a)&&(t[r]=a)}),t}return e},j=(e,t)=>"string"===typeof e?e.replace("%s",t):e(t);var k;const T="PRE_INIT",_="INIT",G="INIT",U="PENDING",z="PASS",Q="ERROR";class Z{constructor(e){let{id:t,name:r,associations:a,formInterceptor:n,options:s}=e;this.id=t,this.name=r,this.formInterceptor=n,this.groupName=null,this.groupIndex=null,this.state=T,this.fieldRef=null,this.associations={fields:c()(a,"fields",[]).filter(e=>!!e.name),callback:c()(a,"callback",()=>{})},this.validate={status:G},this.value=void 0,this.options=Object.assign({},s)}get isReady(){return this.state===_}get isPass(){return this.validate.status===z}setInfo(e){let{groupName:t,groupIndex:r,label:a,rule:n,interceptor:s,noTrim:i,fieldRef:o,errMsg:u}=e;return this.groupName=t,this.groupIndex=r,this.label=a,this.rule=n,this.interceptor=s,this.noTrim=i,this.fieldRef=o,this.errMsg=u,this.state=_,this.path=Z.getFieldValuePath(this),this}getValueFromFormData(e){return Z.computedFieldValueFromFormData(this,e)}setFieldValue(e){return this.setValue(this.formInterceptor.input({value:e,interceptor:this.interceptor})),this}getFieldValue(){return this.formInterceptor.output({value:this.value,interceptor:this.interceptor})}getErrState(){return this.validate.status===z?1:this.validate.status===Q?2:this.validate.status===U?3:0}getErrMsg(){return j(this.errMsg||this.validate.msg||"",this.label)}setValidateStatus(e){let{status:t,msg:r="",validateData:a}=e;return this.validate={status:(e=>1===e?z:2===e?Q:G)(t),msg:r,validateData:Object.assign({},this.validate.validateData,a)},this}async runValidate(e,t){const r=await(async e=>{let{field:t,value:r,formRules:a,getFormData:n}=e;if("function"===typeof t.rule)return await t.rule(r,Object.assign({},{data:n()},{field:t}));if("object"===typeof t.rule&&t.rule instanceof RegExp)return{result:t.rule.test(r),errMsg:""};const s={};if("string"===typeof t.rule){const e=t.rule.split(" ").filter(e=>e.length>0);for(let i of e){let[e,...o]=i.split("-");const u=a[e.toUpperCase()];if("function"===typeof u){if("REQ"!==i&&!0!==a.REQ(r,...o,Object.assign({},{data:n()},{field:t})).result)return{result:!0,errMsg:"",data:s};const l=await u(r,...o,Object.assign({},{data:n()},{field:t}));if(Object.assign(s,{[e.toUpperCase()]:l.data}),!0!==l.result)return{result:!1,errMsg:l.errMsg,data:s}}else console.error(`\u6821\u9a8c\u89c4\u5219${i}\u4e0d\u5728\u5f53\u524dform\u7684rules\u91cc\u9762\uff0c\u8bf7\u786e\u8ba4${t.name}\u7684\u6821\u9a8c\u89c4\u5219${t.rule}\u662f\u5426\u6b63\u786e`)}}return{result:!0,errMsg:"",data:s}})({field:this.clone(),value:this.value,formRules:e,getFormData:t});return this.validate={status:!0===r.result?z:Q,msg:r.errMsg,validateData:Object.assign({},r.data)},this}setValue(e){return this.value===e||(this.value=e,this.validate={status:G}),this}deleteValue(){return this.setValue(void 0),this}clone(){return h()(this)}}k=Z,Z.stateToError=y()(e=>Array.from(e.values()).filter(e=>c()(e,"validate.status")===Q).map(e=>Object.assign({},e.validate,{name:e.name,label:e.label,groupName:e.groupName,fieldRef:e.fieldRef,groupIndex:e.groupIndex,errMsg:e.getErrMsg()}))),Z.findField=(e,t)=>t.id?e.get(t.id):t.groupName?Array.from(e.values()).find(e=>e.name===t.name&&e.groupName===t.groupName&&e.groupIndex===t.groupIndex):Array.from(e.values()).find(e=>e.name===t.name),Z.matchField=(e,t)=>Object.keys(t).filter(e=>!g()(t[e])).every(r=>e[r]===t[r]),Z.matchFields=(e,t)=>{if(!t.groupName){const r=k.findField(e,t);return r?[r]:[]}return Array.from(e.values()).filter(e=>k.matchField(e,t))},Z.matchAssociationFields=(e,t)=>Array.from(e.values()).filter(e=>e.id!==t.id&&(!(!e.associations.fields&&e.associations.fields.length>0)&&e.associations.fields.some(e=>k.matchField(t,e)))),Z.getFieldValuePath=e=>e.groupName&&!g()(e.groupIndex)&&m()(e.groupName.split("."))===e.name?`${e.groupName}["${e.groupIndex}"]`:e.groupName&&!g()(e.groupIndex)?`${e.groupName}["${e.groupIndex}"].${e.name}`:e.name,Z.computedFormDataFormState=y()(e=>F()(Array.from(e.values()),(e,t)=>{if(!t.name)return;const r=t.getFieldValue();I()(e,k.getFieldValuePath(t),r)},{})),Z.computedFieldValueFromFormData=y()((e,t)=>c()(t,k.getFieldValuePath(e))),Z.stateToIsPass=e=>Array.from(e.values()).every(e=>e.isPass);const H=(0,S.createContext)({}),{Provider:Y,Consumer:q}=H,B=()=>{const{openApiRef:e}=(0,S.useContext)(H);return(0,S.useMemo)(()=>({get formData(){return e.current.data},get formState(){return e.current.formState},get openApi(){return e.current},get isPass(){return e.current.isPass},get errors(){return e.current.errors},get emitter(){return e.current.emitter}}),[e])},J=e=>{let{openApi:t,children:r}=e;const a=(0,S.useRef)(t);return a.current=t,V().createElement(Y,{value:{openApiRef:a}},r)},K=(0,S.createContext)({}),{Provider:W,Consumer:X}=K,ee=()=>(0,S.useContext)(K);function te(){return te=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)({}).hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},te.apply(null,arguments)}function re(e,t){if(null==e)return{};var r={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(-1!==t.indexOf(a))continue;r[a]=e[a]}return r}const ae=e=>({getField:(t,r)=>{let a=e.current.getFormState().get(t);if(a)return r(a.clone())},setFieldInfo:t=>e.current.setFormState(e=>{if(!e.get(t.id))return e;const r=new Map(e);return r.set(t.id,t),r})}),ne=["id","defaultValue"],se=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new Promise(e=>setTimeout(()=>{e(...t)},0))},ie=(e,t)=>`${e||"root"}@${t}`,oe=e=>{let{children:t}=e;const r=ee(),a=(0,S.useRef)(r);return a.current=r,(0,S.useEffect)(()=>{const{emitter:e,setFormIsMount:t}=a.current;return t(!0),e.emit("form:mount"),()=>{e.emit("form:unmount")}},[]),(0,S.useEffect)(()=>{const{emitter:e}=a.current;return e.addListener("form:field:add",(e=>t=>{let{id:r,name:a,associations:n}=t;const{setFormState:s,interceptor:i,emitter:o}=e.current;s(e=>{const t=new Map(e);return t.set(r,new Z({id:r,name:a,formInterceptor:i,associations:n})),t}),o.emit(`form-field:mount:${r}`)})(a)),e.addListener("form:field:change",(e=>async t=>{let{id:r,defaultValue:a}=t,n=re(t,ne);const{setFormState:s,initFormData:i,emitter:o}=e.current,{getField:u}=ae(e);u(r,async e=>{e.setInfo(n),(()=>{if(void 0!==e.value)return;const t=e.getValueFromFormData(i);t?e.setFieldValue(t):void 0!==a&&e.setFieldValue(a)})(),s(t=>{const a=new Map(t);return a.set(r,e),a}),void 0!==e.value&&o.emit(`form-field:input:${e.id}`,{value:e.value}),o.emit("form:field:ready",e)})})(a)),e.addListener("form:field:remove",(e=>t=>{let{id:r}=t;const{setFormState:a}=e.current;a(e=>{const t=new Map(e);return t.delete(r),t})})(a)),e.addListener("form:validate",(e=>()=>{const{formState:t,emitter:r}=e.current;Array.from(t.values()).forEach(e=>{r.emit(`form-field:validate:${e.id}`)})})(a)),e.addListener("form:reset",(e=>()=>{const{getFormState:t,emitter:r}=e.current;Array.from(t().values()).forEach(e=>{r.emit(`form-field:input:${e.id}`,{value:void 0})})})(a)),e.addListener("form:set-data",(e=>async t=>{let{data:r,runValidate:a=!0}=t;const{setFormState:n,emitter:s}=e.current;n(e=>{const t=new Map;return Array.from(e.values()).forEach(e=>{if(!e.isReady)return;const a=e.clone();a.setFieldValue(a.getValueFromFormData(r)),t.set(e.id,a),s.emit(`form-field:input:${e.id}`,{value:a.value})}),t}),await se(),a&&Array.from(e.current.formState.values()).forEach(e=>{s.emit(`form-field:validate:${e.id}`)})})(a)),e.addListener("form:set-fields",(e=>async t=>{let{data:r,runValidate:a=!0}=t;const{emitter:n,getFormState:s}=e.current;Array.isArray(r)||(r=[r]);const{setFieldInfo:i,getField:o}=ae(e),u=[];r.forEach(e=>{const{name:t,groupName:r,groupIndex:a,value:l,validate:m}=Object.assign({},e),d=Z.matchFields(s(),{name:t,groupName:r,groupIndex:a});d&&d.length>0&&d.forEach(r=>{r.isReady&&(e.hasOwnProperty("value")&&n.emit(`form-field:input:${r.id}`,{value:g()(t)?c()(l,r.name):l}),o(r.id,e=>{m?e.setValidateStatus(m):u.push(e.id),i(e)}))})}),a&&u.forEach(e=>{n.emit(`form-field:validate:${e}`)})})(a)),e.addListener("form:submit",(e=>async function(){const{task:t,emitter:r,noFilter:a,onError:n,onPrevSubmit:s,onSubmit:i,onComplete:o}=e.current;e.current.getFormState().forEach(e=>{r.emit(`form-field:validate:${e.id}`)});let u=[],l=!1,m={};for(var d=arguments.length,c=new Array(d),f=0;f<d;f++)c[f]=arguments[f];try{if(await t.target,l=Z.stateToIsPass(e.current.getFormState()),l){const t=Z.computedFormDataFormState(e.current.getFormState());if(m=!0===a?t:L(t),r.emit("form:prev-submit",m,...c),s&&!1===await s(m,...c))return r.emit("form:prev-submit:error"),!1;i&&await i(m,...c),r.emit("form:submit:success",m,...c)}else u=Z.stateToError(e.current.getFormState()),r.emit("form:submit:error",u),n&&await n(u,...c)}catch(g){console.error(g),r.emit("form:error",u,...c,g),n&&n(u,...c,g)}r.emit("form:submit:complete",{formData:m,isPass:l,errors:u}),o&&o({formData:m,isPass:l,errors:u})})(a)),e.addListener("form-group:change",(e=>t=>{let{parentId:r,name:a,list:n}=t;const{setGroup:s}=e.current;s(e=>{const t=Object.assign({},e);return t[ie(r,a)]=n.slice(0),t})})(a)),e.addListener("form-group:remove",(e=>t=>{let{parentId:r,name:a}=t;const{setGroup:n}=e.current;n(e=>{const t=Object.assign({},e),n=ie(r,a);if(t[n])return delete t[n],t})})(a)),()=>{e.removeAllListeners()}},[]),t},ue={input:[],output:[]};ue.input.use=(e,t)=>ue.input.push({name:e,exec:t}),ue.output.use=(e,t)=>ue.output.push({name:e,exec:t});const le=ue,me=(e,t,r)=>{Array.isArray(r)||(r=[r]);const a=le[t].concat(c()(e,t,[])),n=r.map(e=>a.find(t=>{let{name:r}=t;return r===e})).filter(e=>!!e);return"input"===t&&n.reverse(),0===n.length?e=>e:(0,A.A)(...n.map(e=>{let{exec:t}=e;return t}))},de="PENDING",ce="COMPLETE";class fe{constructor(e){let{id:t,runner:r}=e;this.id=t,this.isCancel=!1,this.target=Promise.race([Promise.resolve(r()),new Promise(e=>{this.resolve=e})])}cancel(){this.isCancel||(this.isCancel=!0,this.resolve(...arguments))}}class ge{constructor(e){let{onChange:t}=e;this.list=new Map,this.onChange=t}get isComplete(){return 0===this.list.size}async append(e,t){const r=new fe({id:e,runner:t});return this.expire(e),this.list.set(e,r),r.target.then(()=>{this.list.delete(e),this.onChange()}),this.onChange(),r.target}expire(e){const t=this.list.get(e);return t&&(t.cancel(),this.list.delete(e)),this}}const pe=()=>{const[e,t]=(0,S.useState)(ce),r=(0,S.useRef)(new ge({onChange(){t(this.isComplete?ce:de)}}));return{state:e,append:(e,t)=>r.current.append(e,t),expire:e=>r.current.expire(e),get target(){return se().then(()=>Promise.all(Array.from(r.current.list.values()).map(e=>e.target))).then(se)}}},he={REQ:function(e){return{result:P(e),errMsg:""}},TEL:function(e){return{result:/^1[0-9]{10}$/.test(e),errMsg:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u624b\u673a\u53f7"}},EMAIL:function(e){return{result:/^([a-zA-Z0-9_.-])+@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e),errMsg:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u90ae\u7bb1"}},LEN:function(e,t,r){return e=e.toString(),r===t&&e.length!==Number(r)?{result:!1,errMsg:`%s\u957f\u5ea6\u5fc5\u987b\u7b49\u4e8e${r}`}:e.length<t?{result:!1,errMsg:`%s\u957f\u5ea6\u5fc5\u987b\u5927\u4e8e${t}`}:r&&e.length>r?{result:!1,errMsg:`%s\u957f\u5ea6\u5fc5\u987b\u5c0f\u4e8e${r}`}:{result:!0}}},ve=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(he,e)},Fe=(0,S.forwardRef)((e,t)=>{let{data:r,rules:a,interceptors:n,debug:s,noFilter:i,onPrevSubmit:o,onSubmit:u,onError:l,onFormDataChange:m,children:d}=e;const[c,f]=(0,S.useState)(new Map),g=(0,S.useRef)(c),[p,h]=(0,S.useState)(!1),v=pe(),F=w()({debug:s,name:"react-form3"}),{group:b,setGroup:y}=(()=>{const[e,t]=(0,S.useState)(new Map);return{group:e,setGroup:t}})(),E=(e=>{let{formStateRef:t,emitter:r}=e;return(0,S.useMemo)(()=>({emitter:r,submit:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];r.emit("form:submit",t)},get isPass(){return Z.stateToIsPass(t.current)},get formState(){return new Map(t.current)},get data(){return Z.computedFormDataFormState(t.current)},set data(e){r.emit("form:set-data",{data:e})},get errors(){return Z.stateToError(t.current)},reset(){r.emit("form:reset")},onReady(e){r.addListener("form:mount",()=>{e&&e()})},onDestroy(e){r.addListener("form:unmount",()=>{e&&e()})},validateField(e){let{name:a,groupName:n,groupIndex:s}=e;const i=Z.findField(t.current,{name:a,groupName:n,groupIndex:s});i&&r.emit(`form-field:validate:${i.id}`)},validateAll(){r.emit("form:validate")},setFormData:function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];r.emit("form:set-data",{data:e,runValidate:t})},getFormData:()=>Z.computedFormDataFormState(t.current),getField(e){let{name:r,groupName:a,groupIndex:n}=e;return Z.findField(t.current,{name:r,groupName:a,groupIndex:n})},getFields(e){let{name:r,groupName:a,groupIndex:n}=e;return Z.matchFields(t.current,{name:r,groupName:a,groupIndex:n})},setFieldValidate(e){let{name:t,validate:a,groupName:n,groupIndex:s}=e;a?r.emit("form:set-fields",{data:{name:t,groupName:n,groupIndex:s,validate:a}}):console.error("\u5fc5\u987b\u8bbe\u7f6evalidate\u53c2\u6570")},setField(e,t){r.emit("form:set-fields",Object.assign({},t,{data:e}))},setFields(e,t){r.emit("form:set-fields",Object.assign({},t,{data:e}))},setFieldValue(e,t,a){let{name:n,groupName:s,groupIndex:i,validate:o}=e;r.emit("form:set-fields",Object.assign({},a,{data:{name:n,groupName:s,groupIndex:i,value:t,validate:o}}))}}),[t,r])})({emitter:F,formStateRef:g}),I=(e=>{let{interceptors:t}=e;return{input:(0,x.A)(e=>{let{value:r,interceptor:a}=e;return me(t,"input",a)(r)}),output:(0,x.A)(e=>{let{value:r,interceptor:a}=e;return me(t,"output",a)(r)})}})({interceptors:n});return(0,S.useImperativeHandle)(t,()=>E,[E]),V().createElement(W,{value:{emitter:F,openApi:E,task:v,formState:c,getFormState:()=>g.current,setFormState(e){const t="function"===typeof e?e(g.current):e;return g.current=t,f(t),t},formIsMount:p,setFormIsMount:h,group:b,setGroup:y,initFormData:Object.assign({},r),rules:Object.assign({},he,a),interceptor:I,debug:s,noFilter:i,onPrevSubmit:o,onSubmit:u,onError:l,onFormDataChange:m}},V().createElement(J,{openApi:E},V().createElement(oe,null,d)))}),be=(0,S.createContext)({id:"root"}),{Provider:ye}=be,Ee=()=>(0,S.useContext)(be),Ie=e=>{let{id:t,name:r,children:a,defaultValue:n}=e;const{group:s}=ee(),{id:i,index:o,name:u}=Ee(),l=(0,S.useMemo)(()=>c()(s,ie(i,r),[]).findIndex(e=>e.id===t),[t,i,s,r]),m=(0,S.useMemo)(()=>l>-1&&u?`${u}[${o}].${r}`:r,[u,r,l,o]);return V().createElement(ye,{value:{id:t,name:m,group:s,index:l,defaultValue:n}},a({id:t,name:m,group:s,index:l}))},Se=(0,S.forwardRef)((e,t)=>{let{name:r,defaultLength:a=1,empty:n,reverseOrder:s=!0,children:i}=e;const[o,u]=(0,S.useState)([]),l=(0,S.useRef)(o);l.current=o;const{initFormData:m,emitter:d}=ee(),{id:f,name:g,index:p}=Ee(),h=(0,S.useMemo)(()=>p>-1&&g?`${g}[${p}]`:"",[g,p]),v=h?`${h}.${r}`:r,F=e=>Object.assign({},e,{id:f?R()(f+"-"):R()()}),b=(0,x.A)(e=>{let{groupName:t,name:r}=e;const n=e=>{const t=Number.isInteger(a)&&a>0&&!(Array.isArray(e)&&e.length>=a)?$()(0,a).map(e=>l.current[e]||F()):Array.isArray(e)?e.map((e,t)=>l.current[t]||F({defaultValue:e})):[];u(t)};n(c()(m,t?`${t}.${r}`:r));const s=d.addListener("form:set-data",e=>{let{data:a}=e;n(c()(a,t?`${t}.${r}`:r))});return()=>{s.remove()}});(0,S.useEffect)(()=>{d.emit("form-group:change",{parentId:f,name:r,list:o})},[o,f,r,d]),(0,S.useEffect)(()=>()=>{d.emit("form-group:remove",{parentId:f,name:r})},[f,r]),(0,S.useEffect)(()=>b({groupName:h,name:r}),[h,r]);const y=(0,x.A)(e=>{const{isUnshift:t,defaultValue:r}=Object.assign({isUnshift:!1},e);u(e=>{if(0===e.length)return[{id:R()(f)}];const a=e.slice(0);return a[t?"unshift":"push"](F({defaultValue:r})),a})}),E=(0,x.A)(e=>{u(t=>{const r=t.findIndex(t=>t.id===e),a=c()(m,v);Array.isArray(a)&&a.splice(r,1);const n=t.slice(0);return n.splice(r,1),n})});return(0,S.useImperativeHandle)(t,()=>({onAdd:y,onRemove:E})),0===o.length?n:(s?o.slice(0).reverse():o).map(e=>{let{id:t,defaultValue:a}=e;return V().createElement(Ie,{key:t,id:t,name:r,defaultValue:a},e=>{let{index:r}=e;return i({id:t,index:r,length:o.length,onAdd:y,onRemove:()=>E(t)})})})}),Ve=(e,t)=>{if((e=>window.Event&&(e instanceof window.Event||c()(e,"nativeEvent")instanceof window.Event||"function"===typeof c()(e,"preventDefault")))(e)){if(void 0===t)switch(e.target.type){case"checkbox":case"radio":t=e.target.checked;break;default:t=e.target.value}}else t=e;return t},Ae=["name","rule","label","interceptor","associations","noTrim","debounce","onChange","defaultValue","errMsg"],xe=e=>{let{name:t,rule:r,label:a,interceptor:n,associations:s,noTrim:i,debounce:o=0,onChange:u,defaultValue:l,errMsg:m}=e,d=re(e,Ae);const f=(0,S.useId)(),{index:g,name:p,defaultValue:h}=Ee(),{formState:v}=ee(),[F,b]=(0,S.useState)({}),y=(e=>{let{name:t,rule:r,label:a,interceptor:n,associations:s,noTrim:i,defaultValue:o,id:u,groupName:l,groupIndex:m,errMsg:d}=e;const[c,f]=(0,S.useState)(!1),g=(0,S.useRef)(null),{formIsMount:p,emitter:h}=ee(),v=(0,S.useRef)(s);return(0,S.useEffect)(()=>{let e=!1;return p&&(e=!0,f(!0),h.emit("form:field:add",{name:t,associations:v.current,id:u})),()=>{e&&h.emit("form:field:remove",{id:u})}},[p,h,t,u]),(0,S.useEffect)(()=>{c&&-1!==m&&h.emit("form:field:change",{name:t,rule:r,label:a,interceptor:n,noTrim:i,id:u,groupName:l,groupIndex:m,defaultValue:o,fieldRef:g,errMsg:d})},[c,h,t,r,a,n,i,u,l,m,o,g,d]),g})({name:t,rule:r,label:a,interceptor:n,associations:{fields:c()(s,"fields",[]),callback:function(){b(Object.assign({},null==s?void 0:s.callback(...arguments)))}},noTrim:i,defaultValue:c()(h,t)||l,id:f,groupName:p,groupIndex:g,errMsg:m}),{validate:E,isValueChanged:I,dataChange:V,value:A}=(e=>{let{id:t,defaultValue:r,onChange:a,time:n}=e;const s=ee(),{formIsMount:i}=s,o=(0,S.useRef)(s);o.current=s;const[u,l]=(0,S.useState)(!1),[m,d]=(0,S.useState)(r);(0,S.useEffect)(()=>{if(!i)return;const{getField:e,setFieldInfo:r}=ae(o),{emitter:a}=o.current,n=[a.addListener(`form-field:input:${t}`,n=>{let{value:s}=n;d(s),l(!0),e(t,async e=>{e.setValue(s),r(e),void 0!==e.getFieldValue()&&(a.emit("form:field:set-value",{id:t,value:e.getFieldValue(),path:e.path}),a.emit(`form-field:associations:${t}`))})}),a.addListener(`form-field:format:${t}`,r=>{let{format:n}=r;e(t,e=>{const r=n(e.value);e.value!==r&&a.emit(`form-field:input:${t}`,{value:r})})}),a.addListener(`form-field:validate:${t}`,async()=>{const{rules:n,task:s}=o.current;await s.append(t,async()=>{await e(t,async e=>{e.setValidateStatus({status:U}),r(e)}),await e(t,e=>{!0!==e.noTrim&&"string"===typeof e.value&&a.emit(`form-field:format:${t}`,{format:e=>e.trim()})}),await e(t,async e=>{await e.runValidate(n,()=>Z.computedFormDataFormState(o.current.getFormState())),r(e),a.emit(`form-field:validate:complete:${t}`,{validate:e.validate})})})}),a.addListener(`form-field:associations:${t}`,async()=>{const{getFormState:r,openApi:n}=o.current;e(t,e=>{Z.matchAssociationFields(r(),e).forEach(t=>{var r;a.emit("form-field:associations:callback",{target:t,origin:e}),null==(r=t.associations)||r.callback({target:t,origin:e,openApi:n})})})})];return()=>{n.forEach(e=>{e.remove()})}},[i]);const c=(0,x.A)(function(){a&&a(...arguments);const{emitter:e}=o.current,r=Ve(...arguments);e.emit(`form-field:input:${t}`,{value:r})}),f=(0,x.A)(()=>{const{emitter:e}=o.current;e.emit(`form-field:validate:${t}`)}),g=(0,D.YQ)(f,n),p=g.cancel;return(0,S.useEffect)(()=>{const{emitter:e}=o.current,t=e.addListener("form:reset",p);return()=>{t&&t.remove()}},[p]),{isValueChanged:u,value:m,dataChange:c,validate:n?g:f}})({id:f,time:o,onChange:u}),M=v.get(f),w=te({},d,{id:f,name:t,label:a,value:A,fieldRef:y,formData:Z.computedFormDataFormState(v),formState:v,rule:r,groupName:p,groupIndex:g,onChange:V,isValueChanged:I,triggerValidate:E,associationOptions:F});return M?Object.assign({},w,{value:A,errState:M.getErrState(),errMsg:M.getErrMsg()}):w},Me=()=>{const{emitter:e}=ee();return{onClick:(0,S.useCallback)(()=>{e.emit("form:reset")},[e])}},we=e=>{const[t,r]=(0,S.useState)(!1),{isPass:a,emitter:n}=ee(),{onClick:s}=Object.assign({},e);return(0,S.useEffect)(()=>{const e=n.addListener("form:submit:complete",()=>{r(!1)});return()=>{e&&e.remove()}},[n]),{isLoading:t,isPass:a,onClick:(0,S.useCallback)(async function(){r(!0);try{await se();for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];const r=s&&await s(...t);n.emit("form:submit",r||t)}catch(i){console.error(i)}},[n,r])}},Ne=Z.stateToIsPass,$e=Z.stateToError,Ce=Z.computedFormDataFormState,Re=Z.findField,De=Z.matchFields,Pe=Z.computedFieldValueFromFormData,Oe={isNotEmpty:P,isEmpty:O,filterEmpty:L,compileErrMsg:j,stateToIsPass:Ne,stateToError:$e,computedFormDataFormState:Ce,findField:Re,matchFields:De,computedFieldValueFromFormData:Pe}}}]);
//# sourceMappingURL=830.f226b49f.chunk.js.map