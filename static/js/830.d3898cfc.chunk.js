"use strict";(self.webpackChunk_kne_components_react_form=self.webpackChunk_kne_components_react_form||[]).push([[830],{71830(e,t,r){r.r(t),r.d(t,{GroupList:()=>Se,RULES:()=>he,compileErrMsg:()=>k,computedFieldValueFromFormData:()=>Oe,computedFormDataFormState:()=>Re,default:()=>Fe,filterEmpty:()=>j,findField:()=>De,formUtils:()=>Le,interceptors:()=>ue,isEmpty:()=>L,isNotEmpty:()=>O,matchFields:()=>Pe,preset:()=>ve,stateToError:()=>Ce,stateToIsPass:()=>Ne,useField:()=>xe,useFormApi:()=>B,useFormContext:()=>B,useGroup:()=>Ie,useReset:()=>Me,useSubmit:()=>we});var a=r(14888),n=r.n(a),o=r(27497),s=r.n(o),i=r(18710),u=r.n(i),l=r(92679),c=r.n(l),m=r(33227),d=r.n(m),f=r(33076),g=r.n(f),p=r(71406),h=r.n(p),v=r(9211),F=r.n(v),b=r(73075),y=r.n(b),I=r(25647),E=r.n(I),S=r(94922),V=r.n(S),A=r(78430),x=(r(98171),r(78678)),M=r(20775),w=r.n(M),N=r(60094),C=r.n(N),R=r(57325),D=r.n(R),P=r(98424);const O=e=>{if(n()(e)){const t=s()(e);return t.length>0&&t.some(e=>!!e)}return u()(e)?e.length>0:"number"===typeof e?!isNaN(e):!(void 0===e||null===e||""===e||0===e.length)},L=e=>!O(e),j=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(u()(e))return e.map(e=>j(e)).filter(O);if(n()(e)){const t={};return Object.keys(e).forEach(r=>{const a=j(e[r]);O(a)&&(t[r]=a)}),t}return e},k=(e,t)=>"string"===typeof e?e.replace("%s",t):e(t);var T;const _="PRE_INIT",G="INIT",z="INIT",Q="PENDING",U="PASS",Z="ERROR";class H{constructor(e){let{id:t,name:r,associations:a,formInterceptor:n,options:o}=e;this.id=t,this.name=r,this.formInterceptor=n,this.groupName=null,this.groupIndex=null,this.state=_,this.fieldRef=null,this.associations={fields:d()(a,"fields",[]).filter(e=>!!e.name),callback:d()(a,"callback",()=>{})},this.validate={status:z},this.value=void 0,this.options=Object.assign({},o)}get isReady(){return this.state===G}get isPass(){return this.validate.status===U}setInfo(e){let{groupName:t,groupIndex:r,label:a,rule:n,interceptor:o,noTrim:s,fieldRef:i,errMsg:u}=e;return this.groupName=t,this.groupIndex=r,this.label=a,this.rule=n,this.interceptor=o,this.noTrim=s,this.fieldRef=i,this.errMsg=u,this.state=G,this.path=H.getFieldValuePath(this),this}getValueFromFormData(e){return H.computedFieldValueFromFormData(this,e)}setFieldValue(e){return this.setValue(this.formInterceptor.input({value:e,interceptor:this.interceptor})),this}getFieldValue(){return this.formInterceptor.output({value:this.value,interceptor:this.interceptor})}getErrState(){return this.validate.status===U?1:this.validate.status===Z?2:this.validate.status===Q?3:0}getErrMsg(){return k(this.errMsg||this.validate.msg||"",this.label)}setValidateStatus(e){let{status:t,msg:r="",validateData:a}=e;return this.validate={status:(e=>1===e?U:2===e?Z:z)(t),msg:r,validateData:Object.assign({},this.validate.validateData,a)},this}async runValidate(e,t){const r=await(async e=>{let{field:t,value:r,formRules:a,getFormData:n}=e;if("function"===typeof t.rule)return await t.rule(r,Object.assign({},{data:n()},{field:t}));if("object"===typeof t.rule&&t.rule instanceof RegExp)return{result:t.rule.test(r),errMsg:""};const o={};if("string"===typeof t.rule){const e=t.rule.split(" ").filter(e=>e.length>0);for(let s of e){let[e,...i]=s.split("-");const u=a[e.toUpperCase()];if("function"===typeof u){if("REQ"!==s&&!0!==a.REQ(r,...i,Object.assign({},{data:n()},{field:t})).result)return{result:!0,errMsg:"",data:o};const l=await u(r,...i,Object.assign({},{data:n()},{field:t}));if(Object.assign(o,{[e.toUpperCase()]:l.data}),!0!==l.result)return{result:!1,errMsg:l.errMsg,data:o}}else console.error("\u6821\u9a8c\u89c4\u5219".concat(s,"\u4e0d\u5728\u5f53\u524dform\u7684rules\u91cc\u9762\uff0c\u8bf7\u786e\u8ba4").concat(t.name,"\u7684\u6821\u9a8c\u89c4\u5219").concat(t.rule,"\u662f\u5426\u6b63\u786e"))}}return{result:!0,errMsg:"",data:o}})({field:this.clone(),value:this.value,formRules:e,getFormData:t});return this.validate={status:!0===r.result?U:Z,msg:r.errMsg,validateData:Object.assign({},r.data)},this}setValue(e){return this.value===e||(this.value=e,this.validate={status:z}),this}deleteValue(){return this.setValue(void 0),this}clone(){return h()(this)}}T=H,H.stateToError=y()(e=>Array.from(e.values()).filter(e=>d()(e,"validate.status")===Z).map(e=>Object.assign({},e.validate,{name:e.name,label:e.label,groupName:e.groupName,fieldRef:e.fieldRef,groupIndex:e.groupIndex,errMsg:e.getErrMsg()}))),H.findField=(e,t)=>t.id?e.get(t.id):t.groupName?Array.from(e.values()).find(e=>e.name===t.name&&e.groupName===t.groupName&&e.groupIndex===t.groupIndex):Array.from(e.values()).find(e=>e.name===t.name),H.matchField=(e,t)=>Object.keys(t).filter(e=>!g()(t[e])).every(r=>e[r]===t[r]),H.matchFields=(e,t)=>{if(!t.groupName){const r=T.findField(e,t);return r?[r]:[]}return Array.from(e.values()).filter(e=>T.matchField(e,t))},H.matchAssociationFields=(e,t)=>Array.from(e.values()).filter(e=>e.id!==t.id&&(!(!e.associations.fields&&e.associations.fields.length>0)&&e.associations.fields.some(e=>T.matchField(t,e)))),H.getFieldValuePath=e=>e.groupName&&!g()(e.groupIndex)&&c()(e.groupName.split("."))===e.name?"".concat(e.groupName,'["').concat(e.groupIndex,'"]'):e.groupName&&!g()(e.groupIndex)?"".concat(e.groupName,'["').concat(e.groupIndex,'"].').concat(e.name):e.name,H.computedFormDataFormState=y()(e=>F()(Array.from(e.values()),(e,t)=>{if(!t.name)return;const r=t.getFieldValue();E()(e,T.getFieldValuePath(t),r)},{})),H.computedFieldValueFromFormData=y()((e,t)=>d()(t,T.getFieldValuePath(e))),H.stateToIsPass=e=>Array.from(e.values()).every(e=>e.isPass);const $=(0,S.createContext)({}),{Provider:Y,Consumer:q}=$,B=()=>{const{openApiRef:e}=(0,S.useContext)($);return(0,S.useMemo)(()=>({get formData(){return e.current.data},get formState(){return e.current.formState},get openApi(){return e.current},get isPass(){return e.current.isPass},get errors(){return e.current.errors},get emitter(){return e.current.emitter}}),[e])},J=e=>{let{openApi:t,children:r}=e;const a=(0,S.useRef)(t);return a.current=t,V().createElement(Y,{value:{openApiRef:a}},r)},K=(0,S.createContext)({}),{Provider:W,Consumer:X}=K,ee=()=>(0,S.useContext)(K);function te(){return te=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)({}).hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},te.apply(null,arguments)}function re(e,t){if(null==e)return{};var r={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(-1!==t.indexOf(a))continue;r[a]=e[a]}return r}const ae=e=>({getField:(t,r)=>{let a=e.current.getFormState().get(t);if(a)return r(a.clone())},setFieldInfo:t=>e.current.setFormState(e=>{if(!e.get(t.id))return e;const r=new Map(e);return r.set(t.id,t),r})}),ne=["id","defaultValue"],oe=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new Promise(e=>setTimeout(()=>{e(...t)},0))},se=(e,t)=>"".concat(e||"root","@").concat(t),ie=e=>{let{children:t}=e;const r=ee(),a=(0,S.useRef)(r);return a.current=r,(0,S.useEffect)(()=>{const{emitter:e,setFormIsMount:t}=a.current;return t(!0),e.emit("form:mount"),()=>{e.emit("form:unmount")}},[]),(0,S.useEffect)(()=>{const{emitter:e}=a.current;return e.addListener("form:field:add",(e=>t=>{let{id:r,name:a,associations:n}=t;const{setFormState:o,interceptor:s,emitter:i}=e.current;o(e=>{const t=new Map(e);return t.set(r,new H({id:r,name:a,formInterceptor:s,associations:n})),t}),i.emit("form-field:mount:".concat(r))})(a)),e.addListener("form:field:change",(e=>async t=>{let{id:r,defaultValue:a}=t,n=re(t,ne);const{setFormState:o,initFormData:s,emitter:i}=e.current,{getField:u}=ae(e);u(r,async e=>{e.setInfo(n),(()=>{if(void 0!==e.value)return;const t=e.getValueFromFormData(s);t?e.setFieldValue(t):void 0!==a&&e.setFieldValue(a)})(),o(t=>{const a=new Map(t);return a.set(r,e),a}),void 0!==e.value&&i.emit("form-field:input:".concat(e.id),{value:e.value}),i.emit("form:field:ready",e)})})(a)),e.addListener("form:field:remove",(e=>t=>{let{id:r}=t;const{setFormState:a}=e.current;a(e=>{const t=new Map(e);return t.delete(r),t})})(a)),e.addListener("form:validate",(e=>()=>{const{formState:t,emitter:r}=e.current;Array.from(t.values()).forEach(e=>{r.emit("form-field:validate:".concat(e.id))})})(a)),e.addListener("form:reset",(e=>()=>{const{getFormState:t,emitter:r}=e.current;r.emit("form:set-fields",{data:Array.from(t().values()).map(e=>{const t=e.clone();return t.value=void 0,t.validate={},t}),runValidate:!1})})(a)),e.addListener("form:set-data",(e=>async t=>{let{data:r,runValidate:a=!0}=t;const{setFormState:n,emitter:o}=e.current;n(e=>{const t=new Map;return Array.from(e.values()).forEach(e=>{if(!e.isReady)return;const a=e.clone();a.setFieldValue(a.getValueFromFormData(r)),t.set(e.id,a),o.emit("form-field:input:".concat(e.id),{value:a.value})}),t}),await oe(),a&&Array.from(e.current.formState.values()).forEach(e=>{o.emit("form-field:validate:".concat(e.id))})})(a)),e.addListener("form:set-fields",(e=>async t=>{let{data:r,runValidate:a=!0}=t;const{emitter:n,getFormState:o}=e.current;Array.isArray(r)||(r=[r]);const{setFieldInfo:s,getField:i}=ae(e),u=[];r.forEach(e=>{const{name:t,groupName:r,groupIndex:a,value:l,validate:c}=Object.assign({},e),m=H.matchFields(o(),{name:t,groupName:r,groupIndex:a});m&&m.length>0&&m.forEach(r=>{r.isReady&&(e.hasOwnProperty("value")&&n.emit("form-field:input:".concat(r.id),{value:g()(t)?d()(l,r.name):l}),i(r.id,e=>{c?e.setValidateStatus(c):u.push(e.id),s(e)}))})}),a&&u.forEach(e=>{n.emit("form-field:validate:".concat(e))})})(a)),e.addListener("form:submit",(e=>async function(){const{task:t,emitter:r,noFilter:a,onError:n,onPrevSubmit:o,onSubmit:s,onComplete:i}=e.current;e.current.getFormState().forEach(e=>{r.emit("form-field:validate:".concat(e.id))});let u=[],l=!1,c={};for(var m=arguments.length,d=new Array(m),f=0;f<m;f++)d[f]=arguments[f];try{if(await t.target,l=H.stateToIsPass(e.current.getFormState()),l){const t=H.computedFormDataFormState(e.current.getFormState());if(c=!0===a?t:j(t),r.emit("form:prev-submit",c,...d),o&&!1===await o(c,...d))return r.emit("form:prev-submit:error"),!1;s&&await s(c,...d),r.emit("form:submit:success",c,...d)}else u=H.stateToError(e.current.getFormState()),r.emit("form:submit:error",u),n&&await n(u,...d)}catch(g){console.error(g),r.emit("form:error",u,...d,g),n&&n(u,...d,g)}r.emit("form:submit:complete",{formData:c,isPass:l,errors:u}),i&&i({formData:c,isPass:l,errors:u})})(a)),e.addListener("form-group:change",(e=>t=>{let{parentId:r,name:a,list:n}=t;const{setGroup:o}=e.current;o(e=>{const t=Object.assign({},e);return t[se(r,a)]=n.slice(0),t})})(a)),e.addListener("form-group:remove",(e=>t=>{let{parentId:r,name:a}=t;const{setGroup:n}=e.current;n(e=>{const t=Object.assign({},e),n=se(r,a);if(t[n])return delete t[n],t})})(a)),()=>{e.removeAllListeners()}},[]),t},ue={input:[],output:[]};ue.input.use=(e,t)=>ue.input.push({name:e,exec:t}),ue.output.use=(e,t)=>ue.output.push({name:e,exec:t});const le=ue,ce=(e,t,r)=>{Array.isArray(r)||(r=[r]);const a=le[t].concat(d()(e,t,[])),n=r.map(e=>a.find(t=>{let{name:r}=t;return r===e})).filter(e=>!!e);return"input"===t&&n.reverse(),0===n.length?e=>e:(0,A.A)(...n.map(e=>{let{exec:t}=e;return t}))},me="PENDING",de="COMPLETE";class fe{constructor(e){let{id:t,runner:r}=e;this.id=t,this.isCancel=!1,this.target=Promise.race([Promise.resolve(r()),new Promise(e=>{this.resolve=e})])}cancel(){this.isCancel||(this.isCancel=!0,this.resolve(...arguments))}}class ge{constructor(e){let{onChange:t}=e;this.list=new Map,this.onChange=t}get isComplete(){return 0===this.list.size}async append(e,t){const r=new fe({id:e,runner:t});return this.expire(e),this.list.set(e,r),r.target.then(()=>{this.list.delete(e),this.onChange()}),this.onChange(),r.target}expire(e){const t=this.list.get(e);return t&&(t.cancel(),this.list.delete(e)),this}}const pe=()=>{const[e,t]=(0,S.useState)(de),r=(0,S.useRef)(new ge({onChange(){t(this.isComplete?de:me)}}));return{state:e,append:(e,t)=>r.current.append(e,t),expire:e=>r.current.expire(e),get target(){return oe().then(()=>Promise.all(Array.from(r.current.list.values()).map(e=>e.target))).then(oe)}}},he={REQ:function(e){return{result:O(e),errMsg:""}},TEL:function(e){return{result:/^1[0-9]{10}$/.test(e),errMsg:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u624b\u673a\u53f7"}},EMAIL:function(e){return{result:/^([a-zA-Z0-9_.-])+@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e),errMsg:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u90ae\u7bb1"}},LEN:function(e,t,r){return e=e.toString(),r===t&&e.length!==Number(r)?{result:!1,errMsg:"%s\u957f\u5ea6\u5fc5\u987b\u7b49\u4e8e".concat(r)}:e.length<t?{result:!1,errMsg:"%s\u957f\u5ea6\u5fc5\u987b\u5927\u4e8e".concat(t)}:r&&e.length>r?{result:!1,errMsg:"%s\u957f\u5ea6\u5fc5\u987b\u5c0f\u4e8e".concat(r)}:{result:!0}}},ve=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(he,e)},Fe=(0,S.forwardRef)((e,t)=>{let{data:r,rules:a,interceptors:n,debug:o,noFilter:s,onPrevSubmit:i,onSubmit:u,onError:l,onFormDataChange:c,children:m}=e;const[d,f]=(0,S.useState)(new Map),g=(0,S.useRef)(d),[p,h]=(0,S.useState)(!1),v=pe(),F=w()({debug:o,name:"react-form3"}),{group:b,setGroup:y}=(()=>{const[e,t]=(0,S.useState)(new Map);return{group:e,setGroup:t}})(),I=(e=>{let{formStateRef:t,emitter:r}=e;return(0,S.useMemo)(()=>({emitter:r,submit:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];r.emit("form:submit",t)},get isPass(){return H.stateToIsPass(t.current)},get formState(){return new Map(t.current)},get data(){return H.computedFormDataFormState(t.current)},set data(e){r.emit("form:set-data",{data:e})},get errors(){return H.stateToError(t.current)},reset(){r.emit("form:reset")},onReady(e){r.addListener("form:mount",()=>{e&&e()})},onDestroy(e){r.addListener("form:unmount",()=>{e&&e()})},validateField(e){let{name:a,groupName:n,groupIndex:o}=e;const s=H.findField(t.current,{name:a,groupName:n,groupIndex:o});s&&r.emit("form-field:validate:".concat(s.id))},validateAll(){r.emit("form:validate")},setFormData:function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];r.emit("form:set-data",{data:e,runValidate:t})},getFormData:()=>H.computedFormDataFormState(t.current),getField(e){let{name:r,groupName:a,groupIndex:n}=e;return H.findField(t.current,{name:r,groupName:a,groupIndex:n})},getFields(e){let{name:r,groupName:a,groupIndex:n}=e;return H.matchFields(t.current,{name:r,groupName:a,groupIndex:n})},setFieldValidate(e){let{name:t,validate:a,groupName:n,groupIndex:o}=e;a?r.emit("form:set-fields",{data:{name:t,groupName:n,groupIndex:o,validate:a}}):console.error("\u5fc5\u987b\u8bbe\u7f6evalidate\u53c2\u6570")},setField(e,t){r.emit("form:set-fields",Object.assign({},t,{data:e}))},setFields(e,t){r.emit("form:set-fields",Object.assign({},t,{data:e}))},setFieldValue(e,t,a){let{name:n,groupName:o,groupIndex:s,validate:i}=e;r.emit("form:set-fields",Object.assign({},a,{data:{name:n,groupName:o,groupIndex:s,value:t,validate:i}}))}}),[t,r])})({emitter:F,formStateRef:g}),E=(e=>{let{interceptors:t}=e;return{input:(0,x.A)(e=>{let{value:r,interceptor:a}=e;return ce(t,"input",a)(r)}),output:(0,x.A)(e=>{let{value:r,interceptor:a}=e;return ce(t,"output",a)(r)})}})({interceptors:n});return(0,S.useImperativeHandle)(t,()=>I,[I]),V().createElement(W,{value:{emitter:F,openApi:I,task:v,formState:d,getFormState:()=>g.current,setFormState(e){const t="function"===typeof e?e(g.current):e;return g.current=t,f(t),t},formIsMount:p,setFormIsMount:h,group:b,setGroup:y,initFormData:Object.assign({},r),rules:Object.assign({},he,a),interceptor:E,debug:o,noFilter:s,onPrevSubmit:i,onSubmit:u,onError:l,onFormDataChange:c}},V().createElement(J,{openApi:I},V().createElement(ie,null,m)))}),be=(0,S.createContext)({id:"root"}),{Provider:ye}=be,Ie=()=>(0,S.useContext)(be),Ee=e=>{let{id:t,name:r,children:a,defaultValue:n}=e;const{group:o}=ee(),{id:s,index:i,name:u}=Ie(),l=(0,S.useMemo)(()=>d()(o,se(s,r),[]).findIndex(e=>e.id===t),[t,s,o,r]),c=(0,S.useMemo)(()=>l>-1&&u?"".concat(u,"[").concat(i,"].").concat(r):r,[u,r,l,i]);return V().createElement(ye,{value:{id:t,name:c,group:o,index:l,defaultValue:n}},a({id:t,name:c,group:o,index:l}))},Se=(0,S.forwardRef)((e,t)=>{let{name:r,defaultLength:a=1,empty:n,reverseOrder:o=!0,children:s}=e;const[i,u]=(0,S.useState)([]),l=(0,S.useRef)(i);l.current=i;const{initFormData:c,emitter:m}=ee(),{id:f,name:g,index:p}=Ie(),h=(0,S.useMemo)(()=>p>-1&&g?"".concat(g,"[").concat(p,"]"):"",[g,p]),v=h?"".concat(h,".").concat(r):r,F=e=>Object.assign({},e,{id:f?D()(f+"-"):D()()}),b=(0,x.A)(e=>{let{groupName:t,name:r}=e;const n=e=>{const t=Number.isInteger(a)&&a>0&&!(Array.isArray(e)&&e.length>=a)?C()(0,a).map(e=>l.current[e]||F()):Array.isArray(e)?e.map((e,t)=>l.current[t]||F({defaultValue:e})):[];u(t)};n(d()(c,t?"".concat(t,".").concat(r):r));const o=m.addListener("form:set-data",e=>{let{data:a}=e;n(d()(a,t?"".concat(t,".").concat(r):r))});return()=>{o.remove()}});(0,S.useEffect)(()=>{m.emit("form-group:change",{parentId:f,name:r,list:i})},[i,f,r,m]),(0,S.useEffect)(()=>()=>{m.emit("form-group:remove",{parentId:f,name:r})},[f,r]),(0,S.useEffect)(()=>b({groupName:h,name:r}),[h,r]);const y=(0,x.A)(e=>{const{defaultValue:t}=Object.assign({},e);u(e=>{if(0===e.length)return[{id:D()(f)}];const r=e.slice(0);return r.push(F({defaultValue:t})),r})}),I=(0,x.A)(e=>{u(t=>{const r=t.findIndex(t=>t.id===e),a=d()(c,v);Array.isArray(a)&&a.splice(r,1);const n=t.slice(0);return n.splice(r,1),n})});return(0,S.useImperativeHandle)(t,()=>({onAdd:y,onRemove:I})),0===i.length?n:(o?i.slice(0).reverse():i).map(e=>{let{id:t,defaultValue:a}=e;return V().createElement(Ee,{key:t,id:t,name:r,defaultValue:a},e=>{let{index:r}=e;return s({id:t,index:r,length:i.length,onAdd:y,onRemove:()=>I(t)})})})}),Ve=(e,t)=>{if((e=>window.Event&&(e instanceof window.Event||d()(e,"nativeEvent")instanceof window.Event||"function"===typeof d()(e,"preventDefault")))(e)){if(void 0===t)switch(e.target.type){case"checkbox":case"radio":t=e.target.checked;break;default:t=e.target.value}}else t=e;return t},Ae=["name","rule","label","interceptor","associations","noTrim","debounce","onChange","defaultValue","errMsg"],xe=e=>{let{name:t,rule:r,label:a,interceptor:n,associations:o,noTrim:s,debounce:i=0,onChange:u,defaultValue:l,errMsg:c}=e,m=re(e,Ae);const f=(0,S.useId)(),{index:g,name:p,defaultValue:h}=Ie(),{formState:v}=ee(),[F,b]=(0,S.useState)({}),y=(e=>{let{name:t,rule:r,label:a,interceptor:n,associations:o,noTrim:s,defaultValue:i,id:u,groupName:l,groupIndex:c,errMsg:m}=e;const[d,f]=(0,S.useState)(!1),g=(0,S.useRef)(null),{formIsMount:p,emitter:h}=ee(),v=(0,S.useRef)(o);return(0,S.useEffect)(()=>{let e=!1;return p&&(e=!0,f(!0),h.emit("form:field:add",{name:t,associations:v.current,id:u})),()=>{e&&h.emit("form:field:remove",{id:u})}},[p,h,t,u]),(0,S.useEffect)(()=>{d&&-1!==c&&h.emit("form:field:change",{name:t,rule:r,label:a,interceptor:n,noTrim:s,id:u,groupName:l,groupIndex:c,defaultValue:i,fieldRef:g,errMsg:m})},[d,h,t,r,a,n,s,u,l,c,i,g,m]),g})({name:t,rule:r,label:a,interceptor:n,associations:{fields:d()(o,"fields",[]),callback:function(){b(Object.assign({},null==o?void 0:o.callback(...arguments)))}},noTrim:s,defaultValue:d()(h,t)||l,id:f,groupName:p,groupIndex:g,errMsg:c}),{validate:I,isValueChanged:E,dataChange:V,value:A}=(e=>{let{id:t,defaultValue:r,onChange:a,time:n}=e;const o=ee(),{formIsMount:s}=o,i=(0,S.useRef)(o);i.current=o;const[u,l]=(0,S.useState)(!1),[c,m]=(0,S.useState)(r);(0,S.useEffect)(()=>{if(!s)return;const{getField:e,setFieldInfo:r}=ae(i),{emitter:a}=i.current,n=[a.addListener("form-field:input:".concat(t),n=>{let{value:o}=n;m(o),l(!0),e(t,async e=>{e.setValue(o),r(e),void 0!==e.getFieldValue()&&(a.emit("form:field:set-value",{id:t,value:e.getFieldValue(),path:e.path}),a.emit("form-field:associations:".concat(t)))})}),a.addListener("form-field:format:".concat(t),r=>{let{format:n}=r;e(t,e=>{const r=n(e.value);e.value!==r&&a.emit("form-field:input:".concat(t),{value:r})})}),a.addListener("form-field:validate:".concat(t),async()=>{const{rules:n,task:o}=i.current;await o.append(t,async()=>{await e(t,async e=>{e.setValidateStatus({status:Q}),r(e)}),await e(t,e=>{!0!==e.noTrim&&"string"===typeof e.value&&a.emit("form-field:format:".concat(t),{format:e=>e.trim()})}),await e(t,async e=>{await e.runValidate(n,()=>H.computedFormDataFormState(i.current.getFormState())),r(e),a.emit("form-field:validate:complete:".concat(t),{validate:e.validate})})})}),a.addListener("form-field:associations:".concat(t),async()=>{const{getFormState:r,openApi:n}=i.current;e(t,e=>{H.matchAssociationFields(r(),e).forEach(t=>{var r;a.emit("form-field:associations:callback",{target:t,origin:e}),null==(r=t.associations)||r.callback({target:t,origin:e,openApi:n})})})})];return()=>{n.forEach(e=>{e.remove()})}},[s]);const d=(0,x.A)(function(){a&&a(...arguments);const{emitter:e}=i.current,r=Ve(...arguments);e.emit("form-field:input:".concat(t),{value:r})}),f=(0,x.A)(()=>{const{emitter:e}=i.current;e.emit("form-field:validate:".concat(t))}),g=(0,P.YQ)(f,n),p=g.cancel;return(0,S.useEffect)(()=>{const{emitter:e}=i.current,t=e.addListener("form:reset",p);return()=>{t&&t.remove()}},[p]),{isValueChanged:u,value:c,dataChange:d,validate:n?g:f}})({id:f,time:i,onChange:u}),M=v.get(f),w=te({},m,{id:f,name:t,label:a,value:A,fieldRef:y,formData:H.computedFormDataFormState(v),formState:v,rule:r,groupName:p,groupIndex:g,onChange:V,isValueChanged:E,triggerValidate:I,associationOptions:F});return M?Object.assign({},w,{value:A,errState:M.getErrState(),errMsg:M.getErrMsg()}):w},Me=()=>{const{emitter:e}=ee();return{onClick:(0,S.useCallback)(()=>{e.emit("form:reset")},[e])}},we=e=>{const[t,r]=(0,S.useState)(!1),a=B(),{onClick:n}=Object.assign({},e);return(0,S.useEffect)(()=>{const e=a.emitter.addListener("form:submit:complete",()=>{r(!1)});return()=>{e&&e.remove()}},[a.emitter]),{isLoading:t,isPass:a.isPass,onClick:(0,S.useCallback)(async function(){r(!0);try{await oe();for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];const r=n&&await n(...t);a.emitter.emit("form:submit",r||t)}catch(s){console.error(s)}},[a.emitter,r])}},Ne=H.stateToIsPass,Ce=H.stateToError,Re=H.computedFormDataFormState,De=H.findField,Pe=H.matchFields,Oe=H.computedFieldValueFromFormData,Le={isNotEmpty:O,isEmpty:L,filterEmpty:j,compileErrMsg:k,stateToIsPass:Ne,stateToError:Ce,computedFormDataFormState:Re,findField:De,matchFields:Pe,computedFieldValueFromFormData:Oe}}}]);
//# sourceMappingURL=830.d3898cfc.chunk.js.map