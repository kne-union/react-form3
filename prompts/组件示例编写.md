# 组件示例编写提示词

本提示词用于编写遵循特定目录结构规范的 React 项目组件示例。

## 1. 目录结构规范

### 项目目录布局

```
{PROJECT_ROOT}/
├── src/                      # 源代码目录
│   └── components/           # 组件源代码
│       ├── ComponentA/       # 单个组件目录
│       ├── ComponentB/       # 带子组件的目录
│       │   ├── Sub1/
│       │   ├── Sub2/
│       │   └── index.js
│       └── ...
├── doc/                      # 文档及示例目录（所有组件共用）
│   ├── example.json          # 示例配置文件（核心）
│   ├── api.md                # 组件API文档
│   ├── summary.md            # 组件简要描述
│   ├── base.js               # 基础示例代码
│   ├── component-a.js        # ComponentA示例
│   ├── component-b.js        # ComponentB主组件示例
│   ├── component-b-sub1.js   # ComponentB子组件Sub1示例
│   ├── component-b-sub2.js   # ComponentB子组件Sub2示例
│   └── style.scss            # 示例样式（可选）
└── package.json              # 项目配置文件
```

### 示例文件规则

**重要**：所有组件的示例文件都统一放在项目根目录的 `doc/` 中，而不是在每个组件目录下创建单独的 `doc/` 目录。

- 单个组件：使用组件名的小写短横线形式命名示例文件，如 `component-a.js`
- 带子组件的组件：主组件示例使用组件名，子组件示例使用组件名加子组件名，如 `component-b.js`、`component-b-sub1.js`

### 项目配置变量

在编写示例时需要替换以下变量：

| 变量名 | 说明 | 示例值 |
|--------|------|--------|
| `{PACKAGE_NAME}` | 从 package.json 的 name 字段获取 | `@kne/react-file` |
| `{PROJECT_NAME}` | 项目名称，用于 getPublicPath | `react-file` |
| `{LIB_NAME}` | 组件库名称，通常是驼峰形式 | `ReactFile` |

## 2. example.json 配置结构

所有组件的示例配置统一在 `doc/example.json` 中管理：

### 基础配置示例

```json
{
  "isFull": false,
  "list": [
    {
      "title": "这里填写示例标题",
      "description": "这里填写示例说明",
      "code": "./base.js",
      "scope": [
        {
          "name": "_MarkdownComponentsRender",
          "packageName": "@kne/markdown-components-render",
          "importStatement": "import * as _MarkdownComponentsRender from \"@kne/markdown-components-render\""
        },
        {
          "name": "antd",
          "packageName": "antd"
        },
        {
          "name": "_ReactFetch",
          "packageName": "@kne/react-fetch"
        },
        {
          "name": "md",
          "packageName": "./doc/example.md"
        },
        {
          "packageName": "@kne/markdown-components-render/dist/index.css"
        }
      ]
    }
  ]
}
```

### 完整配置示例

```json
{
  "isFull": true,
  "list": [
    {
      "title": "ComponentA",
      "description": "组件A的描述",
      "code": "./component-a.js",
      "scope": [
        {
          "name": "_{LIB_NAME}",
          "packageName": "{PACKAGE_NAME}",
          "importStatement": "import * as _{LIB_NAME} from \"{PACKAGE_NAME}\""
        },
        {
          "packageName": "{PACKAGE_NAME}/dist/index.css"
        },
        {
          "name": "antd",
          "packageName": "antd"
        },
        {
          "name": "remoteLoader",
          "packageName": "@kne/remote-loader"
        }
      ]
    }
  ]
}
```

## 3. 示例代码规范

### 导入方式

- 使用 `scope` 中声明的变量名：`const { FilePreview } = _{LIB_NAME};`
- 工具包引用：`const { createWithRemoteLoader, getPublicPath } = remoteLoader;`

### 标准示例模板（需要 PureGlobal 模拟数据）

```javascript
const { YourComponent } = _{LIB_NAME};
const { createWithRemoteLoader, getPublicPath } = remoteLoader;

const BaseExample = createWithRemoteLoader({
  modules: ['components-core:Global@PureGlobal', 'components-core:InfoPage']
})(({ remoteModules }) => {
  const [PureGlobal, InfoPage] = remoteModules;
  return (
    <PureGlobal preset={{
      ajax: async api => {
        return { data: { code: 0, data: api.loader() } };
      },
      apis: {
        file: {
          staticUrl: getPublicPath('{PROJECT_NAME}') || window.PUBLIC_URL,
          getUrl: {
            loader: async ({ params }) => {
              // 模拟数据
              return 'mock-url';
            }
          }
        }
      }
    }}>
      <InfoPage>
        <InfoPage.Part title="示例标题">
          <YourComponent prop="value" />
        </InfoPage.Part>
      </InfoPage>
    </PureGlobal>
  );
});

render(<BaseExample />);
```

### 简化示例模板（无需远程加载）

```javascript
const { YourComponent } = _{LIB_NAME};
const { Flex, Switch } = antd;
const { useState } = React;

const BaseExample = () => {
  const [state, setState] = useState(false);
  return (
    <Flex vertical gap={12}>
      <YourComponent prop={value} />
    </Flex>
  );
};

render(<BaseExample />);
```

## 4. scope 依赖声明规则

| 场景 | name | packageName | importStatement（可选） |
|------|------|-------------|------------------------|
| 项目组件 | `_{LIB_NAME}` | `{PACKAGE_NAME}` | `import * as _{LIB_NAME} from "{PACKAGE_NAME}"` |
| 组件样式 | - | `{PACKAGE_NAME}/dist/index.css` | -（根据 `src` 中的组件是否有样式引用决定） |
| 远程加载器 | `remoteLoader` | `@kne/remote-loader` | - |
| Antd组件 | `antd` | `antd` | - |
| React原生 | `React` | - | -（无需声明） |

### 样式引用说明

**重要**：
- 组件样式 `{PACKAGE_NAME}/dist/index.css` 的引入取决于 `src` 目录中的组件是否引用了样式文件
- 检查方法：在 `src/` 目录下搜索样式文件的导入语句，如 `.scss`、`.css`、`.module.scss`、`.module.css` 等
- 常见的样式导入语句：`import style from './style.module.scss'`、`import './style.css'` 等
- 如果任意组件中存在样式文件的导入语句，则需要在 `scope` 中添加样式引用

### 实际项目示例

在本项目中，`src/md-components.js` 文件导入了样式文件：

```javascript
import style from './style.module.scss';
```

因此需要在 `doc/example.json` 中添加样式引用：

```json
{
  "packageName": "@kne/markdown-components-render/dist/index.css"
}
```

### 依赖声明注意事项

**重要**：在编写示例时，需要确保 `example.json` 的 `scope` 中声明的依赖与示例代码中使用的依赖完全一致：

1. **检查示例代码中使用的所有外部依赖**
   - 项目组件：`const { Component } = _{LIB_NAME};`
   - Antd 组件：`const { Button, message } = antd;`
   - React 原生：`const { useState, useRef } = React;`
   - 远程加载器：`const { createWithRemoteLoader } = remoteLoader;`

2. **在 `scope` 中声明所有使用的依赖**

   | 代码中使用 | scope 需要声明 | 示例 |
   |-----------|----------------|------|
   | `_{LIB_NAME}` | ✅ 需要 | `{"name": "_ReactForm", "packageName": "@kne/current-lib_react-form"}` |
   | `antd` 组件/方法 | ✅ 需要 | `{"name": "antd", "packageName": "antd"}` |
   | `React` | ❌ 不需要 | React 是原生依赖，无需声明 |
   | `remoteLoader` | ✅ 需要（如果使用） | `{"name": "remoteLoader", "packageName": "@kne/remote-loader"}` |

3. **常见错误示例**

   ❌ **错误**：示例代码中使用了 `antd.message`，但 scope 中没有声明 antd
   ```javascript
   // doc/example.json
   {
     "code": "./example.js",
     "scope": [
       { "name": "_ReactForm", "packageName": "@kne/current-lib_react-form" }
       // 缺少 antd 声明！
     ]
   }

   // doc/example.js
   const { message } = antd; // ❌ 报错: antd is not defined
   ```

   ✅ **正确**：添加 antd 声明
   ```javascript
   // doc/example.json
   {
     "code": "./example.js",
     "scope": [
       { "name": "_ReactForm", "packageName": "@kne/current-lib_react-form" },
       { "name": "antd", "packageName": "antd" } // ✅ 正确声明
     ]
   }

   // doc/example.js
   const { message } = antd; // ✅ 正常工作
   ```

4. **检查清单**

   在完成示例编写后，请检查以下内容：
   - [ ] 示例代码中使用的所有 antd 组件/方法是否在 scope 中声明了 `{"name": "antd", "packageName": "antd"}`
   - [ ] 示例代码中是否使用了 `antd.message`、`antd.Button` 等
   - [ ] scope 中声明的依赖是否都被示例代码使用（避免不必要的依赖）

## 5. API文档编写

`doc/api.md` 中包含所有组件的API文档，使用表格格式：

```markdown
### 组件名称

组件描述

#### 属性

| 属性 | 类型 | 默认值 | 描述 |
|------|------|-------|------|
| propName | string | - | 属性描述 |
```

## 6. 组件导出规范

在组件的主入口 `index.js` 中，需要导出所有子组件：

```javascript
export { default } from './MainComponent';
export { default as SubComponent1 } from './SubComponent1';
export { default as SubComponent2 } from './SubComponent2';
```

在示例中通过解构引用：

```javascript
const { MainComponent, SubComponent1, SubComponent2 } = _{LIB_NAME};
```

## 7. 使用说明

### 创建新组件示例步骤

1. 在 `src/components/` 下创建或编辑组件
2. 在 `doc/example.json` 中添加示例配置
3. 在 `doc/` 目录下创建对应的 `.js` 示例文件
4. 在 `doc/api.md` 中添加组件API文档（如果是新组件）
5. 在组件的 `index.js` 中确保正确导出

### 变量替换示例

假设项目 `package.json` 中配置为：

```json
{
  "name": "@your-org/your-project"
}
```

则变量值为：

- `{PACKAGE_NAME}` → `@your-org/your-project`
- `{PROJECT_NAME}` → `your-project`
- `{LIB_NAME}` → `YourProject`

实际使用时需要替换为：

```json
{
  "name": "_YourProject",
  "packageName": "@your-org/your-project",
  "importStatement": "import * as _YourProject from \"@your-org/your-project\""
}
```

```javascript
const { YourComponent } = _YourProject;
const { createWithRemoteLoader, getPublicPath } = remoteLoader;

// ...
staticUrl: getPublicPath('your-project') || window.PUBLIC_URL,
```

## 8. 项目参考

本项目的示例文件位于 `doc/` 目录：

- `doc/example.json` - 所有组件的示例配置
- `doc/api.md` - 所有组件的API文档
- `doc/summary.md` - 组件整体概述
- `doc/base.js` - 基础示例代码
