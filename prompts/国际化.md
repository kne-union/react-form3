# 组件国际化指南

## 概述

本指南用于将组件完成国际化。

## 一、创建的文件

1. **`src/withLocale.js`** - 统一的国际化 HOC，所有组件共用
2. **`src/locale/zh-CN.js`** - 中文语言包，所有组件共用
3. **`src/locale/en-US.js`** - 英文语言包，所有组件共用

## 二、需要修改的文件类型

### 主组件文件
- 添加 `useIntl` Hook
- 用 `withLocale` 包裹导出

### FormInner 表单组件
- 添加 `useIntl` Hook
- 用 `withLocale` 包裹导出
- 表单 label 国际化

### getColumns 等工具函数
- 通过参数接收 `formatMessage`
- 移除内部的 `useIntl` 和 `withLocale` 引入

### Action 操作组件
- 添加 `useIntl` Hook
- 用 `withLocale` 包裹导出

## 三、国际化的关键模式

### 1. useIntl Hook 使用
```javascript
import { useIntl } from '@kne/react-intl';

const Component = () => {
  const { formatMessage } = useIntl();
  return <div>{formatMessage({ id: 'ComponentName.Key' })}</div>;
};
```

### 2. withLocale 包裹普通组件
```javascript
import withLocale from '../withLocale';
import { useIntl } from '@kne/react-intl';

const ComponentInner = ({ ...props }) => {
  const { formatMessage } = useIntl();
  // 将所有中文替换为 formatMessage({ id: 'ComponentName.Key' })
  return <div>{formatMessage({ id: 'ComponentName.Key' })}</div>;
};

const Component = withLocale(ComponentInner);

export default Component;
```

### 3. createWithRemoteLoader 组件（推荐格式）
```javascript
import withLocale from '../withLocale';
import { useIntl } from '@kne/react-intl';

const ComponentInner = createWithRemoteLoader({...})(({ remoteModules, ...props }) => {
  const { formatMessage } = useIntl();
  // ...
});

const Component = withLocale(ComponentInner);

export default Component;
```

**注意：** 对于 `createWithRemoteLoader` 创建的组件，可以先用 `ComponentInner` 存储，再用 `withLocale` 包裹。

### 4. getColumns 等工具函数（formatMessage 从父组件传入）
```javascript
const getColumns = ({formatMessage}) => {
  return [
    {
      name: 'name',
      title: formatMessage({ id: 'ComponentName.Key' })
    }
  ];
};

// 父组件中使用
const columns = getColumns({formatMessage});
```

### 5. 带参数的翻译
```javascript
formatMessage({ id: 'ComponentName.KeyWithParam' }, { name: value })
```

## 四、注意事项

1. **所有使用 `useIntl` 的组件必须用 `withLocale` 包裹**
2. **`getColumns` 等工具函数通过参数接收 `formatMessage`，不使用 `useIntl`**
3. **语言包中避免重复的 key**，命名规则：`组件名 + 功能名`，如 `PersonalCard.status.online`
4. **`createWithRemoteLoader` 创建的组件内部使用 useIntl 时，外层需要重命名并用 withLocale 包裹**
5. 注意检查 `withLocale`文件的引用地址，根目录组件使用 `../withLocale`

---

# 组件国际化操作步骤

## 步骤

### 1. 更新语言包文件
在 `src/locale/zh-CN.js` 和 `src/locale/en-US.js` 中添加对应的翻译文本：
```javascript
// zh-CN.js
const locale = {
  ComponentName: {
    status: {
      online: '在线',
      offline: '离线'
    },
    summary: '简介'
  }
};

// en-US.js
const locale = {
  ComponentName: {
    status: {
      online: 'Online',
      offline: 'Offline'
    },
    summary: 'Summary'
  }
};
```

### 2. 修改组件文件

#### 主组件修改模式：
```javascript
import withLocale from '../withLocale';
import { useIntl } from '@kne/react-intl';

const ComponentInner = ({ ...props }) => {
  const { formatMessage } = useIntl();
  // 将所有中文替换为 formatMessage({ id: 'ComponentName.Key' })
  return (
    // ...
  );
};

const Component = withLocale(ComponentInner);

export default Component;
```

#### FormInner 修改模式：
```javascript
import withLocale from '../withLocale';
import { useIntl } from '@kne/react-intl';

const FormInnerInner = createWithRemoteLoader({...})(({ remoteModules, ...props }) => {
  const { formatMessage } = useIntl();
  // label={formatMessage({ id: 'ComponentName.Key' })}
  // ...
});

const FormInner = withLocale(FormInnerInner);

export default FormInner;
```

#### Action 操作组件修改模式：
```javascript
import withLocale from '../withLocale';
import { useIntl } from '@kne/react-intl';

const ActionInner = createWithRemoteLoader({...})(({ remoteModules, ...props }) => {
  const { formatMessage } = useIntl();
  // ...
});

const ActionComponent = withLocale(ActionInner);

export default ActionComponent;
```

#### getColumns 修改模式：
```javascript
// 移除 useIntl 和 withLocale 引入
const getColumns = ({formatMessage}) => {
  return [
    {
      name: 'xxx',
      title: formatMessage({ id: 'ComponentName.Key' })
    }
  ];
};
```

父组件中调用：`getColumns({formatMessage})`

### 3. 语言包 key 命名规范
- 避免重复，使用 `组件名+功能名` 格式，如 `PersonalCard.status.online`、`UserName`、`UserRole`、`SettingType`
- 中文和英文语言包保持完全一致的 key 结构

### 4. 检查要点
- [ ] 所有使用 `useIntl` 的组件都用 `withLocale` 包裹
- [ ] `getColumns` 等工具函数通过参数接收 `formatMessage`
- [ ] 语言包中无重复 key
- [ ] `withLocale` 引用路径正确（组件在子目录使用 `../withLocale`）

### 5. 最后检查
运行命令找到所有使用 useIntl 的文件，确保都已正确包裹：
```bash
grep -r "useIntl" src/ --include="*.js" -l
```
